<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Communauté</title>
  </head>
  <body>
    <h1>Fil Communautaire</h1>
    <div class="chat-container">
      {% for msg in messages %}
      <div
        class="chat-message {% if msg.author == 'Admin' %}admin{% else %}user{% endif %}"
      >
        <strong>{{ msg.author }} :</strong> {{ msg.content }} {% if msg.type !=
        'message' %}
        <em>[{{ msg.type }}]</em>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    {% if current_user.is_admin %}
    <form method="post">
      <div class="chat-input">
        <textarea name="message" placeholder="Écrire un message..."></textarea>
        <button type="submit">Envoyer</button>
        <button type="button" class="plus-button" onclick="toggleOptions()">
          +
        </button>
      </div>
      <div id="extra-options" style="display: none; margin-top: 10px">
        <button
          type="button"
          onclick="window.location.href=`{{ url_for('create_poll') }}`"
        >
          Créer un sondage
        </button>
        <button
          type="button"
          onclick="window.location.href=`{{ url_for('create_quiz') }}`"
        >
          Créer un quiz
        </button>
      </div>
    </form>
    {% endif %}

    <div class="section">
      <h2>Sondages</h2>
      {% for poll in polls %}
      <div class="poll">
        <h3>{{ poll.question }}</h3>
        {% if poll.has_voted %}
        <p>Résultats :</p>
        <ul>
          {% for option in poll.options %}
          <li>
            {{ option.option_text }} : {% if poll.total_votes > 0 %} {{
            "%.0f"|format((option.votes / poll.total_votes * 100)) }} % {% else
            %} 0 % {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <form
          class="poll-form"
          method="post"
          action="{{ url_for('community_poll_vote', poll_id=poll.id) }}"
        >
          {% for option in poll.options %}
          <div class="poll-option">
            <input
              type="radio"
              id="poll_option_{{ option.id }}"
              name="option"
              value="{{ option.id }}"
              required
            />
            <label for="poll_option_{{ option.id }}"
              >{{ option.option_text }}</label
            >
          </div>
          {% endfor %}
          <button type="submit">Voter</button>
        </form>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <div class="section">
      <h2>Quizzes</h2>
      {% for quiz in quizzes %}
      <div class="quiz">
        <h3>{{ quiz.title }}</h3>
        <p>{{ quiz.description }}</p>
        <a href="{{ url_for('quiz_intro', quiz_id=quiz.id) }}"
          >Répondre au quiz</a
        >
      </div>
      {% endfor %}
    </div>

    <script>
      function toggleOptions() {
        var extra = document.getElementById("extra-options");
        extra.style.display = extra.style.display === "none" ? "block" : "none";
      }
    </script>
  </body>
</html>
