<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profil Utilisateur</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 350px;
      margin: 0 auto;
      background-color: white;
      height: 100vh;
      position: relative;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    .leaf-icon {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: #FFBF47;
      color: white;
      padding: 8px;
      border-radius: 12px;
    }
    
    .profile-info {
      background-color: #FFE6E6;
      margin: 20px;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }
    
    .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: #ccc;
      margin: 0 auto 15px;
      overflow: hidden;
    }
    
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .info-item {
      text-align: left;
      margin-bottom: 10px;
    }
    
    .info-label {
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .badges-section {
      background-color: #FFE6E6;
      margin: 20px;
      padding: 15px;
      border-radius: 12px;
    }
    
    .badges-title {
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .badges-container {
      display: flex;
      justify-content: space-between;
    }
    
    .badge {
      width: 45px;
      height: 45px;
    }
    
    .edit-button {
      background-color: #FF7B8C;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px;
      width: calc(100% - 40px);
      margin: 20px;
      font-size: 16px;
      cursor: pointer;
    }
    
    .logout {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .logout a {
      color: black;
      text-decoration: underline;
    }
    
    .bottom-nav {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #1D7373;
      display: flex;
      justify-content: space-around;
      padding: 15px 0;
    }
    
    .nav-item {
      color: white;
      font-size: 24px;
    }
  </style>
</head>
<body>
    <!-- PHP Backend Code -->
    <?php
    // Démarrer ou reprendre la session
    session_start();
    
    // Vérifier si l'utilisateur est connecté
    if (!isset($_SESSION['user_id'])) {
      // Si non connecté, rediriger vers la page de connexion
      header('Location: login.php');
      exit;
    }
    
    // Se connecter à la base de données
    $servername = "localhost";
    $username = "username";
    $password = "password";
    $dbname = "mydb";
    
    try {
      $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
      $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
      
      // Préparer et exécuter la requête pour récupérer les informations de l'utilisateur
      $stmt = $conn->prepare("SELECT nom, prenom, email, statut, photo_profil FROM utilisateurs WHERE id = :id");
      $stmt->bindParam(':id', $_SESSION['user_id']);
      $stmt->execute();
      
      // Récupérer les données
      $user = $stmt->fetch(PDO::FETCH_ASSOC);
      
      // Récupérer les badges de l'utilisateur
      $stmt = $conn->prepare("
        SELECT b.image_url, b.nom 
        FROM badges b
        JOIN utilisateur_badges ub ON b.id = ub.badge_id
        WHERE ub.utilisateur_id = :id
      ");
      $stmt->bindParam(':id', $_SESSION['user_id']);
      $stmt->execute();
      
      $badges = $stmt->fetchAll(PDO::FETCH_ASSOC);
      
    } catch(PDOException $e) {
      echo "Erreur de connexion: " . $e->getMessage();
      exit;
    }
    ?>
  
    <div class="container">
      <!-- Icône feuille -->
      <div class="leaf-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M2 12.5C2 12.5 5 9 12 9s10 3.5 10 3.5"></path>
          <path d="M12 15l-2-2 2-2 2 2-2 2z"></path>
        </svg>
      </div>
      
      <!-- Informations de profil -->
      <div class="profile-info">
        <div class="avatar">
          <?php if (!empty($user['photo_profil'])): ?>
            <img src="<?php echo htmlspecialchars($user['photo_profil']); ?>" alt="Photo de profil">
          <?php else: ?>
            <img src="/images/default-avatar.png" alt="Photo de profil par défaut">
          <?php endif; ?>
        </div>
        
        <div class="info-item">
          <div class="info-label">Nom :</div>
          <div><?php echo htmlspecialchars($user['nom']); ?></div>
        </div>
        
        <div class="info-item">
          <div class="info-label">Prénom :</div>
          <div><?php echo htmlspecialchars($user['prenom']); ?></div>
        </div>
        
        <div class="info-item">
          <div class="info-label">Adresse Mail :</div>
          <div><?php echo htmlspecialchars($user['email']); ?></div>
        </div>
        
        <div class="info-item">
          <div class="info-label">Statut :</div>
          <div><?php echo htmlspecialchars($user['statut']); ?></div>
        </div>
      </div>
      
      <!-- Section badges -->
      <div class="badges-section">
        <div class="badges-title">Badges :</div>
        <div class="badges-container">
          <?php if (!empty($badges)): ?>
            <?php foreach($badges as $badge): ?>
              <img class="badge" src="<?php echo htmlspecialchars($badge['image_url']); ?>" alt="<?php echo htmlspecialchars($badge['nom']); ?>">
            <?php endforeach; ?>
          <?php else: ?>
            <p>Aucun badge obtenu pour l'instant.</p>
          <?php endif; ?>
        </div>
      </div>
      
      <!-- Bouton modifier -->
      <button class="edit-button" onclick="window.location.href='edit_profile.php'">Modifier mes informations</button>
      
      <!-- Lien déconnexion -->
      <div class="logout">
        <a href="logout.php">Se déconnecter</a>
      </div>
      
      <!-- Barre de navigation du bas -->
      <div class="bottom-nav">
        <div class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
          </svg>
        </div>
        <div class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="2" width="20" height="20" rx="5"></rect>
            <path d="M2 12h20"></path>
            <path d="M12 2v20"></path>
          </svg>
        </div>
        <div class="nav-item">
          <a href="index.html"> <img src="images/logo_jaune.png" style="height: auto; width: 30px;" alt="Logo jaune"> </a>
        </div>
        <div class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
        </div>
        <div class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
      </div>
    </div>
  </body>
  </html>